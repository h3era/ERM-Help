<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Библиотека функций</title>
<LINK REL="stylesheet" MEDIA="screen" TYPE="text/css" HREF="../style.css">
<script src="../Rec/script.js"></script></head>
<body scroll="no">
<DIV id="buttonMenu">
<SPAN CLASS="options">Разделы:&nbsp;&nbsp;</SPAN>
 <A HREF="#Portal1" title="Контроль типа нанимаемого в Портале Вызова существа" CLASS="button">1</A>
 <A HREF="#Portal2" title="Контроль кол-ва нанимаемых в Портале Вызова существ" CLASS="button">2</A>
 <A HREF="#HE" title="Прочтение результатов диалога HE:C" CLASS="button">3</A>
 <A HREF="#Str" title="Функция для работы со строками на низком уровне" CLASS="button">4</A>
 <A HREF="#def" title="Проигрывание любой анимации на юните в бою" CLASS="button">5</a>
 <A HREF="#str2" title="Получение адресов переменных WoG'а (альтернатива функции работы строк на низких уровнях)" CLASS="button">6</a>

</DIV>

<DIV id="text">
<style>	.erm-container {background-color: #d3c6b6;}
	.erm-code {list-style: decimal; padding-left:10; margin: 5 0 10 30}
</style>
<p align="center"><b><font size="5">Библиотека функций UN:C</font></b></p>
<p align="left"><font size="4">Команда <a href="../Rec/UN.htm#C">UN:C</a> работает с памятью. Используя её, можно редактировать даже те области героев, 
которые казались за гранью достижимого. Здесь приведено несколько полезных функций, не являющихся стандартными. Пользуйтесь!</font></p>
<p align="center"><font size="5"><b><a name="Portal1"></a>Контроль типа нанимаемого в Портале Вызова существа</b></font></p>
<p align="left">
<script type="erm">!?FU20114&x1=-1;
!!UN:C6919500/4/?y1;
!!VRy1:+56;
!!UN:Cy1/4/?y2;
!!VRy2:+60;
!!UN&x3=0:Cy2/4/x2;
!!UN&x3<>0:Cy2/4/?x2;
!?FU20114&x1<>-1;
!!UN:C6933756/4/?y1;
!!VRy1:+2884;
!!UN:Cy1/4/?y2;
!!VRx1:*360 +60 +y2;
!!UN&x3=0:Cx1/4/x2;
!!UN&x3<>0:Cx1/4/?x2;</script>
<i>Вызов:</i>
<script type="erm">!!FU20114:P#1/$/#2;
!!FU20114:P#1/$; (#2=0)</script>
<b>#1</b>: &nbsp;&nbsp;&nbsp; № города (-1 = текущий)<br>
<b>$</b>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<a target="form" href="../Form/Creature.htm">тип существа</a>. -1 – значит нет Портала, 
или ещё не сгенерирован тип (сгенерируется при заходе в окно замка).<br>
<b>#2</b>: &nbsp;&nbsp;&nbsp; 0 - 
установить $, любое другое значение - получить $.</p>
<p align="center"><font size="5">
<a name="Portal2"></a>Контроль кол-ва нанимаемых в Портале Вызова существ</font></p>
<p align="left">
<script type="erm">!?FU20115&x1=-1;
!!UN:C6919500/4/?y1;
!!VRy1:+56;
!!UN:Cy1/4/?y2;
!!VRy2:+64;
!!UN&x3=0:Cy2/2/x2;
!!UN&x3<>0:Cy2/2/?x2;
!?FU20115&x1<>-1;
!!UN:C6933756/4/?y1;
!!VRy1:+2884;
!!UN:Cy1/4/?y2;
!!VRx1:*360 +64 +y2;
!!UN&x3=0:Cx1/2/x2;
!!UN&x3<>0:Cx1/2/?x2;</script>
<i>Вызов:</i>
<script type="erm">!!FU20115:P#1/$/#2;
!!FU20115:P#1/$; (#2=0)</script>
#1: &nbsp;&nbsp;&nbsp; № города (-1 = текущий)<br>
<b>$:</b> &nbsp;&nbsp;&nbsp; кол-во существ<br>
<b>#2:&nbsp;&nbsp;&nbsp; </b>&nbsp;0 - установить $, 
любое другое значение - получить $.<br>
<b>
Примечание</b> - если на первой неделе в город ни разу не 
заходили (или нет Портала), тип и кол-во существ ещё не сгенерированы, 
и кол-во будет выдавать всякий мусор.</p>
<p align="center"><b><font size="5"><a name="HE"></a>Прочтение результатов диалога HE:C</font></b></p>
<p align="left"><i>Позволяет после команды
<a href="../Rec/HE.htm#C">HE:C</a> посмотреть, что осталось в верхних 
(добавляемых) слотах, и использовать её не только для добавления существ, но и 
для оставления, без особых трудностей. Для WoG 3.58f и <a href="TE.htm"><font id="red">TE</font></a>.<br>
</i>
<script type="erm">!?FU20116;
!!UN:V=358/?i;
!!VRy1&1:S8585652;
!!VRy1&-1:S8647508;
!!UN:Cy1/4/?x1;
!!VRy1:+4;
!!UN:Cy1/4/?x3;
!!VRy1:+4;
!!UN:Cy1/4/?x5;
!!VRy1:+4;
!!UN:Cy1/4/?x7;
!!VRy1:+4;
!!UN:Cy1/4/?x9;
!!VRy1:+4;
!!UN:Cy1/4/?x11;
!!VRy1:+4;
!!UN:Cy1/4/?x13;
!!VRy1:+4;
!!UN:Cy1/4/?x2;
!!VRy1:+4;
!!UN:Cy1/4/?x4;
!!VRy1:+4;
!!UN:Cy1/4/?x6;
!!VRy1:+4;
!!UN:Cy1/4/?x8;
!!VRy1:+4;
!!UN:Cy1/4/?x10;
!!VRy1:+4;
!!UN:Cy1/4/?x12;
!!VRy1:+4;
!!UN:Cy1/4/?x14;</script>
<i>Вызов:</i>
<script type="erm">!!FU20116:P?1/?2/?3/?4/?5/?6/?7/?8/?9/?10/?11/?12/?13/?14;</script>
?1,?3&hellip;?13 - типы существ в слотах 1..7 соответственно,<br>
?2,?4&hellip;?14 - их кол-во.</p>
<p align="left">&nbsp;</p>
<p align="center"><b><font size="5"><a name="Str"></a>Функция для работы со строками на низком уровне</font></b></p>
<i>Иногда при работе с !!UN:C требуется 
работать со строками. Приходится писать для этого функции. Написать их несложно, 
и я решил поделиться:</i><br>
<br>
Получение адреса <i>z</i>-переменной номер x1 (возврат в x2)<br>
Поддерживаются версии: </i><b>3.58f, <a href="TE.htm"><font id="red">TE</font></a></b>
<script type="erm">!?FU12925;
!!UN:V?y1/?y2;
!!VRy3&y1=358:S40225400;
!!VRy3&y1=359:S9597416;
!!VRx2&y3=0:S0;
!!FU&y3=0:E;
!!VRx2:Sx1*512+y3;

!?FU12926; Копирование строки по адресу. x1 - источник, x2 - приёмник.
!!DO12927/0/511/1:Px1/x2;

!?FU12927;
!!VRy1:Sx1+x16;
!!VRy2:Sx2+x16;
!!UN:Cy1/1/?y3 Cy2/1/y3;
!!VRx16&y3=0:S511;</script>
<p><i>А теперь сразу же полезный скрипт, использующий их.</i></p>
<p align="center"><b><font size="5"><a name="def"></a>Проигрывание любой анимации на юните в бою</font></b><br></p>
<br>
<i>Данный скрипт позволяет проигрывать любую анимацию (из DEF) на любом юните в бою (т. е. 
не только из списка <a target="form" href="../Form/FormatAnimation.htm">анимаций</a>). 
Требует наличия функции 12925 для работы (см. выше).<br>
</i>
<script type="erm">!?FU12930;
!!UN:V?y10/?y11;
!!VRy12&y10=358:S69016332;
!!VRy12&y10=359:S61479692;
!!UN&y12<>0:Cy12/4/-1;
!!UN:C4454270/4/?y1;
!!VRy1:+660;
!!VRy2:Sy1+8;
!!VRx4:*256+x3;
!!FU12925:Px2/?y5;
!!UN:Cy1/4/?y3Cy2/4/?y4Cy1/4/y5Cy2/4/x4;
!!BMx1:V55;
!!UN:Cy1/4/y3Cy2/4/y4;</script>

Использование функции:<br>
<b>x1</b> - номер стека в бою<br>
<b>x2</b> - номер <i>z</i>-переменной, в которой хранится имя def-файла для проигрывания<br>
<b>Примечание:</b> Для работы требуется функция 12925 из функций работы со строками<br>
<b>x3</b> - позиция относительно монстра:<br>
<b>0</b>: Нижняя часть анимации совпадает с нижней частью существа (например, молитва)<br>
<b>1</b>: Центр анимации совпадает с центром существа (например, инферно)<br>
<b>2</b>: Анимация находится сверху существа (пример в голову не лезет)<br>
<b>3</b>: Анимация находится спереди существа (срабатывание гномского сопротивления)<br>
<b>4</b>: Анимация находится в углу возле атакующего героя<br>
<b>x4</b> - Полупрозрачность (0 - нету, т.е. анимация непрозрачна, 1 - анимация 
полупрозрачна)<br>
К примеру, полупрозрачность - как молитва, воскрешение, лечение, 
страх, &hellip;<br>
Непрозрачное: Мораль, проклятие, старость, болезнь, &hellip; <br>
<br>
Работают любые def-файлы, хоть с карты приключений, любые. Анимация 
проигрывается один раз, после чего пропадает.<p><i>К сожалению скрипт сейчас 
лучше не использовать, т.к. имеют место некоторые проблемы с кешированием. &quot;Хорошее&quot; 
решение этой проблемы, к сожалению, найти не удалось&hellip;</i></p>
<p align="center"><font size="5"><b><a name="str2"></a>Получение адресов переменных ВоГа</b></font></p>
<p align="left"><i>При работе с UN:C бывает нужно получить адрес какой-то 
Z-переменной.<br>
Вот скрипт, записывающий адрес z1 в v4138.<br>
Для WoG 3.58f и <a href="TE.htm"><font id="red">TE</font></a></i></p>
<p>
<script type="erm">!#UN:A0/9/?y10; [бэкап номера переменной Z]
!#UN&y10<0:A0/9/?z-1; [бэкап текста (3.59)]

!#UN:A0/9/1; [art0.Name = z1]>
!#UN:C6687592/4/?y1; [получить адрес массива артефактов]
!#UN:Cy1/4/?v4138; [получить art0. Имя - адрес z1. Имя идёт первым в инфо артефакта, так y1 указывает на art0.Name]
[v4138 хранит адрес z1]

!#UN&y10>=0:A0/9/y10; [восстановить номер переменной Z]
!#UN&y10<0:A0/9/z-1; [восстановить текст (3.59)]</script></p>

</div>
<script src="../erm.js"></script></body></html>