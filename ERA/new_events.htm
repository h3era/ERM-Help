<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Справочник по ЭРА</title>
<LINK REL="stylesheet" MEDIA="screen" TYPE="text/css" HREF="../style.css">
<script language="JScript" src="../Rec/script.js"></script></head>
<body scroll="no">
<DIV id="buttonMenu">

<A style="position:absolute; right:4" href="#UP" CLASS="button" title="Вернуться к началу">&uarr;</a>

<form target="_self" action="" style="text-align:left"> <SPAN CLASS="options">Триггеры:&nbsp;&nbsp;</SPAN>
	<select name="menu" title="Быстрый переход к описанию триггера..." onchange="location=value">
	<option selected value="#">------------ нажмите для выбора ------------</option>
	<optgroup label="Новые ERM триггеры:">
		<option value="#2.3">(OnKeyPressed) Нажатие клавиши</option>
		<option value="#2.15">(OnGameEnter) отображение карты мира при загрузке/старте игры</option>
		<option value="#2.16">(OnGameLeave) при выходе в главное меню/закрытии игры</option>
		<option value="#2.1">(OnSavegameWrite) Запись данных в сохранение</option>
		<option value="#2.2">(OnSavegameRead) Загрузка данных из сохранения</option>
		<option value="#2.8">(OnAfterSaveGame) после сохранения игры</option>
		<option value="#2.18">(OnEveryDay) в начале нового игрового дня</option>
		<option value="#2.10">(OnBeforeHeroInteraction) до взаимодействия героя с героем</option>
		<option value="#2.11">(OnAfterHeroInteraction) после взаимодействия героя с героем</option>
		<option value="#2.27">(OnKingdomOverviewMouseClick) клик в "Обзоре королевства" </option>
		<option value="#2.14">(OnChat) событие чата</option>
	</optgroup>
	<optgroup label="&nbsp;- Экран битвы">
		<option value="#2.19">(OnBeforeBattlefieldVisible) в тёмной фазе загрузки боя</option>
		<option value="#2.20">(OnBattlefieldVisible) при отображении поля боя</option>
		<option value="#2.22">(OnCombatRound) перед началом нового раунда</option>
		<option value="#2.21">(OnAfterTacticsPhase) после окончания тактической фазы</option>
		<option value="#2.7">(OnBattleRegeneratePhase) Фаза регенерации в бою</option>
		<option value="#2.6">(OnBattleStackObtainsTurn) Отряд получает ход в бою</option>
		<option value="#2.12">(OnStackToStackDamage) при получении урона стеком</option>
		<option value="#2.13">(OnAICalcStackAttackEffect) ИИ расчёт эффективности атаки по отряду</option>
	</optgroup>
	<optgroup label="&nbsp;- Окно героя">
		<option value="#2.4">(OnOpenHeroScreen) Открытие окна</option>
		<option value="#2.30">(OnLoadHeroScreen) до открытия экрана (тёмная фаза)</option>
		<option value="#2.37">(OnPreHeroScreen) перед загрузкой экрана (тёмная фаза)</option>
		<option value="#2.38">(OnPostHeroScreen) после закрытия окна (тёмная фаза)</option>
		<option value="#2.5">(OnCloseHeroScreen) Закрытие окна</option>
	</optgroup>
	<optgroup label="&nbsp;- Экран города">
		<option value="#2.32">(OnOpenTownScreen) Открытие окна</option>
		<option value="#2.35">(OnPreTownScreen) до отображения экрана (тёмная фаза)</option>
		<option value="#2.34">(OnSwithTownScreen) при переключении городов в окне</option>
		<option value="#2.26">(OnTownHallMouseClick) клик в "Городском холле"</option>
		<option value="#2.31">(OnBuildTownBuilding) постройка зданий в городе</option>
		<option value="#2.36">(OnPostTownScreen) когда закрывается экран города (тёмная фаза)</option>
		<option value="#2.33">(OnCloseTownScreen) Закрытие окна</option>
	</optgroup>
	<optgroup label="&nbsp;- Диалог найма рекрутов">
		<option value="../Rec/RD.htm#open_23">(OnOpenRecruitDlg) Открытие (создание) диалога</option>
		<option value="../Rec/RD.htm#click_25">(OnRecruitDlgMouseClick) при клике мышью в диалоге</option>
		<option value="../Rec/RD.htm#calc_28">(OnRecruitDlgRecalc) пересчёт кол-ва существ в диалоге</option>
		<option value="../Rec/RD.htm#action_29">(OnRecruitDlgAction) при найме существ в диалоге</option>
		<option value="../Rec/RD.htm#close_24">(OnCloseRecruitDlg) Закрытие диалога</option>
	</optgroup>
	<optgroup label="Расширенные стандартные события">
		<option value="#1.1">!?GM1</option>
		<option value="#1.2">!?MM0</option>
	</optgroup></select>
</form>

</DIV>

<DIV id="text">
<a name="up"></a>

<h2 align="center">Новые события (триггеры)<a href="../ERA/index.htm" title="Работает только с ERA.."><img src="../Img/era.gif" class="TE"></a></h2>

<p>В ERA была реализована возможность использовать для ERM-функций буквенное обозначение (имя) в виде <b id="erm"><font class="tr">!?FU</font>(имя)</b>.<br>
Именованные функции – это всегда произвольный текст между скобками, который заменяется на этапе загрузки карты на автоматические свободные номера (всегда уникальные).<br>
<u><b onclick="HideIt(1)" class="h">Примеры (<b id="show1">показать</b>)</b></u><div id="1" class="b"><p>
<script type="erm">!!DO(НайтиПустойСлотУгероя)/i/j/k:P?y1;</script>
Важно также знать, что можно и так:
<script type="erm">...
!!VRy1:S(имя);
!!FUy1:P;
...
!!SN:W^имя^/?y2;</script>
<u>Работает это так</u>: как только встретили не в строке, но в ЕРМ коде скобки с текстом (&hellip;) - выделить под это (имя) номер функции или взять уже выделенный ранее, 
после чего вставить в код. Также, по умолчанию создаётся одноимённая <a href="../Rec/SN_era.htm#W">SN:W</a>-переменная со значением номера функции, выделенного для данного имени (т.е. в примере имеем y1=y2). 
Но при этом, соответствие имён функций и выделенных для них ID хранится вне <a href="../Rec/SN_era.htm#W">ассоциативной памяти</a>.</p></div>
В ERA была убрана привязка к диапазону 0..30000 для ERM-функций. Функции, кроме FU1..FU29999, должны быть только именованные для максимальной совместимости.<br>
ERA резервирует для своих нужд функции с номерами 77000..77999. Скриптописцы и создатели плагинов могут использовать значения в диапазоне 40000..134217727.</p>
Новые события вводятся в игру не в виде привычных ERM триггеров вида <b id="erm"><font class="tr">!?XX</font></b>, а в виде именованных функций вида <b id="erm"><font class="tr">!?FU</font>(OnXXXX)</b>.</p>
<p>Все новые события обладают набором из 16 локальных (неизменяемых, повторно генерируемыми событиями) параметров, которые можно читать/записывать, обращаясь напрямую к x1..x16 
(или же через устаревшую команду <a href="../Rec/SN_era.htm#X">SN:X</a>).<br>
<u>Пример</u>:
<script type="erm">!?FU(OnKeyPressed)&x1=27; нажата клавиша ESC (код 27)
!!VRx2:S1; отключить стандартную реакцию</script></p>
<p>См. также: <a href="../Cont/LogicEvent.htm">Логика срабатывания событий</a>.</p>
<hr noshade>
<p><a name="2.1"></a>
<font id="red"><b>!?FU(OnSavegameWrite);</b></font><br>
Запись данных в сохранение.</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>В этом событии возможна запись пользовательских данных в файловые секции при помощи машинной функции <i class="event">WriteSavegameSection</i>. Все ЕРМ переменные к этому моменту уже сохранены.</p>
<hr noshade>
<p><a name="2.2"></a>
<font id="red"><b>!?FU(OnSavegameRead);</b></font><br>
Загрузка данных из сохранения.</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>В этом событии возможно чтение пользовательских данных из файловых секций при помощи машинной функции <i class="event">ReadSavegameSection</i>. Все ЕРМ переменные к этому моменту уже загружены.</p>
<hr noshade>
<p><a name="2.3"></a>
<font id="red"><b>!?FU(OnKeyPressed);</b></font><br>
Нажатие клавиши.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i><a href="../Form/Keys.htm" target="form">код клавиши</a></i>
 2:  <i>блокировать обработку игрой? (0 - нет, 1 - да)</i></pre></p>
<p>Для определения того, в каком игровом окне мы сейчас находимся, служит функция <a href="api.htm#state" class="event">GetGameState</a>.<br>
Переменные v1..v10 и z1 после события <i class="event">OnKeyPressed</i> автоматически восстанавливают свои прежние значения.</p>
<p><i id="bold">Замечание:</i> поскольку данное событие возникает во всех игровых диалогах, не рекомендуется использовать общие глобальные переменные между показами диалогов, так как событие из диалога может их испортить.<br>
<u>Пример</u>:
<script type="erm">!?FU(OnKeyPressed); нажатие клавиши
!!VRy1:Sx1; y1 - код клавиши
!!FU&y1<>83:E; выйти, если код не 83 (клавиша "S")
!!SN:L^Era.dll^/?y2; получили описатель библиотеки ERA в y2
!!SN:Ay2/^GetGameState^/?y3; y3 - адрес функции GetGameState
!!SN:Ey3/1/?y4/?y5; y4 - ID родительского диалога, y5 - текущего
!!FU&y4<>4205280:E; выйти, если это не карта приключений
!!VRx2:S1; блокировать стандартное действие
!!IF:M^К сожалению, сохранение в данный момент невозможно^;</script></p>
<hr noshade>
<p><a name="2.4"></a>
<font id="red"><b>!?FU(OnOpenHeroScreen);</b></font><br>
Открытие окна героя.</p>
<p><a name="2.5"></a>
<font id="red"><b>!?FU(OnCloseHeroScreen);</b></font><br>
Закрытие окна героя.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер героя</i></i></pre>
<p>В событии <i class="event">OnCloseHeroScreen</i> значение параметра x1 такое же, как и в <i class="event">OnOpenHeroScreen</i>, 
т.е. это номер первоначального героя, для которого был открыт экран героя.<br>
Окно героя даёт возможность переключаться между героями игрока без генерации новых событий открытия/закрытия.<br>
Для обоих событий работает синтаксис <b id="erm"><font class="re">!!HE</font>-1:&hellip;</b>.</p>
<hr noshade>
<p><a name="2.6"></a>
<font id="red"><b>!?FU(OnBattleStackObtainsTurn);</b></font><br>
Отряд получает ход в бою.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>сторона (0 - левая, 1 - правая)</i>
 2:  <i>номер отряда (0..21)</i></pre></p>
<p><u>Пример</u>:
<script type="erm">!?FU(OnBattleStackObtainsTurn);
!!SN:X0/0; в бою только первый отряд героя будет получать право хода</script></p>
<hr noshade>
<p><a name="2.7"></a>
<font id="red"><b>!?FU(OnBattleRegeneratePhase);</b></font><br>
Фаза регенерации в бою.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер отряда (0..41)</i>
 2:  <i>указатель на структуру TBattleMonster</i>
 3:  <i>блокировать регенерацию? (0 - нет, 1 - да)</i></pre></p>
<p>В этом событии происходит регенерация Кошмарных Гидр, Троллей, Призраков.<br>
<u>Пример</u>:
<script type="erm">!?FU(OnBattleRegeneratePhase);
!!VRy1:Sx1; y1 - номер отряда
!!FU&y1>21:E; вышли, если это защитники
!!BMy1:M41/999/3; наложить эксп. благословение на отряд
; Теперь все отряды атакующего всегда имеют экспертное благословение</script></p>
<hr noshade>
<p><a name="2.8"></a>
<font id="red"><b>!?FU(OnAfterSaveGame);</b></font><br>
После сохранения игры.</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p><u>Пример</u>:
<script type="erm">!?(OnAfterSaveGame);
!!IF:M^Теперь, когда игра сохранена, предлагаю вам выключить компьютер и отдохнуть^;
!!UN:C0/4/0; вызвать крах игры</script></p>
<hr noshade>
<p><a name="2.10"></a>
<font id="red"><b>!?FU(OnBeforeHeroInteraction);</b></font><br>
До взаимодействия героя с героем.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер героя-инициатора</i>
 2:  <i>номер героя-цели</i>
 3:  <i>разрешить взаимодействие? (1 - да, 0 - нет)</i></pre></p>
<p>Взаимодействие может быть встречей героев игрока, союзных героев, или нападением на противника.</p>
<hr noshade>
<p><a name="2.11"></a>
<font id="red"><b>!?FU(OnAfterHeroInteraction);</b></font><br>
После взаимодействия героя с героем.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер героя-инициатора</i>
 2:  <i>номер героя-цели</i></pre></p>
<hr noshade>
<p><a name="2.12"></a>
<font id="red"><b>!?FU(OnStackToStackDamage);</b></font><br>
Происходит при подсчёте урона, наносимого одним стеком другому стеку (включая стрельбу).</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>атакующий отряд (0..41) или -1</i>
 2:  <i>защищающийся отряд (0..41) или -1</i>
 3:  <i>конечный урон (НЕ МЕНЯТЬ!)</i>
 4:  <i>конечный урон (ИЗМЕНЯЕМЫЙ)</i>
 5:  <i>базовый урон</i>
 6:  <i>бонус урона (из-за разницы атака/защиты, кавалеристского блонуса или любого настроенного бонуса)</i>
 7:  <i>дальняя атака? (0 - рукопашная атака, 1 дистанционнаяесли не 0 или 1, то содержит мусор)</i>
 8:  <i>расстояние (только для теоретических атак установлено)</i>
 9:  <i>теоретическая атака? (расчёт для подсказки или ИИ: 0 - реальный урон, 1 - расчётный)</i></pre></p>
<hr noshade>
<p><a name="2.13"></a>
<font id="red"><b>!?FU(OnAICalcStackAttackEffect);</b></font><br>
Возникает, когда ИИ вычисляет эффект от атаки стека.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>атакующий отряд (0..41)</i>
 2:  <i>защищающийся отряд (0..41)</i>
 3:  <i>значение эффекта (ИЗМЕНЯЕМОЕ)</i>
 4:  <i>значение эффекта (НЕ МЕНЯТЬ)</i></pre></p>
<hr noshade>
<p><a name="2.14"></a>
<font id="red"><b>!?FU(OnChat);</b></font><br>
Событие чата.
<pre id="Q1">Первый параметр определяет тип события и остальные параметры:
0 (Вход в чат)
	Запретить вход? (0..1)
1 (Ввод)
	Строка ввода
	Действие: 0 (очистить панель), 1 (закрыть панель) или 2 (по умолчанию)
2 (Выход из чата)</pre></p>
<hr noshade>
<p><a name="2.15"></a>
<font id="red"><b>!?FU(OnGameEnter);</b></font><br>
Возникает после загрузки/начала новой игры (игрок получил контроль над мышью).</p>
<p><a name="2.16"></a>
<font id="red"><b>!?FU(OnGameLeave);</b></font><br>
Возникает при выходе в главное меню/закрытии игры.</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<hr noshade>
<p><a name="2.18"></a>
<font id="red"><b>!?FU(OnEveryDay);</b></font><br>
Возникает в начале нового игрового дня (до таймеров).</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>То же, что и <a href="../Tr/TM.htm" class="event">OnErmTimer N</a> (он же !?TM), но происходит каждый день для каждого игрока (включая ИИ) без каких-либо настроек и раньше всех остальных триггеров <a href="../Tr/TM.htm">!?TM</a>.<br>
<u>Пример</u>:
<script type="erm">!?FU(OnEveryDay)&-1000; каждый день для любого ИИ-игрока
...</script></p>
<hr noshade>
<p><a name="2.19"></a>
<font id="red"><b>!?FU(OnBeforeBattlefieldVisible);</b></font><br>
Возникает в тёмной фазе загрузки боя (прямо перед !?BR&v997=-1).</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>В этом событии WoG применяет заклинания к стекам и начальные настройки стрельбы/рукопашнной/удар-возврат.<br>
<b>ВАЖНО!</b> Нельзя использовать ресиверы <a href="../Rec/BM.htm">BM</a> и <a href="../Rec/EA.htm">EA</a> до <i class="event">OnBeforeBattlefieldVisible</i>, т.к. бой ещё не начался, и весь боевой менеджер либо не инициализирован, либо имеет старые структуры данных с прошлого боя.</p>
<hr noshade>
<p><a name="2.20"></a>
<font id="red"><b>!?FU(OnBattlefieldVisible);</b></font><br>
Возникает при отображении поля боя.</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>Прямо перед этим событием игра меняет тему на боевую и отображает всплывающее сообщение о тактической расстановке войск (если есть тактический навык).</p>
<hr noshade>
<p><a name="2.21"></a>
<font id="red"><b>!?FU(OnAfterTacticsPhase);</b></font><br>
Возникает сразу после окончания тактической фазы (или после <a href="#2.19" class="event">OnBeforeBattlefieldVisible</a>, если тактической фазы не было).</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>В этом событии WoG вызывает стражей Санта-гремлинов (потому что теперь стеки находятся на своих конечных позициях).</p>
<hr noshade>
<p><a name="2.22"></a>
<font id="red"><b>!?FU(OnCombatRound);</b></font><br>
Возникает перед началом нового раунда (только для видимых реальных раундов).</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>v997 - номер раунда. Для тактической фазы оно начинается с -1000000000. Для обычной фазы боя отсчёт начинается с 0. 
Каждый раунд v997 увеличивается на единицу, поэтому он может служить постоянно растущим уникальным идентификатором раунда.<br>
<i id="bold">Замечание:</i> значение v997 в других триггерах может быть другим!<br>
<u>Пример</u>:
<script type="erm">!?FU(OnCombatRound)&v997=0; на 1ом нетактическом видимом реальном ранде
; применять заклинания, воспроизводить музыку, изменять параметры существ и т.д.</script></p>
<hr noshade>
<p><a name="2.26"></a>
<font id="red"><b>!?FU(OnTownHallMouseClick);</b></font><br>
Возникает при клике в экране &quot;Городской холл&quot;.</p>
<p><a name="2.27"></a>
<font id="red"><b>!?FU(OnKingdomOverviewMouseClick);</b></font><br>
Возникает при клике в экране &quot;Обзор королевства&quot;.</p>
<p><pre id="Q1"><b>Параметры:</b> <i>нет</i></pre></p>
<p>Все параметры, как обычно, можно получать с помощью <a href="../Rec/CM.htm">!!CM</a>. Реакцию по умолчанию можно отключать.</p>
<hr noshade>
<p><a name="2.30"></a>
<font id="red"><b>!?FU(OnLoadHeroScreen);</b></font><br>
Возникает до открытия экрана героя (тёмная фаза).</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер героя</i></i></pre></p>
<p>Событие происходит непосредственно перед отрисовкой экрана героя для конкретного героя: после события <a href="#2.4" class="event">OnOpenHeroScreen</a> и при каждом переключении в одном диалоге между героями игрока. 
Также, событие происходит во время нажатия на героя в таверне и в бою (со специальными плагинами).<br>
Событие может быть использовано для изменения информации/навыков/войск героя ТОЛЬКО в окне героя.</p>
<hr noshade>
<p><a name="2.31"></a>
<font id="red"><b>!?FU(OnBuildTownBuilding);</b></font><br>
Постройка зданий в городе.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер города</i></i>
 2:  <i><a target="form" href="../Form/BuldingsInTowns.htm">номер здания</a></i></i></pre></p>
<p>Событие происходит, когда текущий игрок (включая ИИ) строит здание в замке.</p>
<hr noshade>
<p><a name="2.32"></a>
<font id="red"><b>!?FU(OnOpenTownScreen);</b></font><br>
Возникает до загрузки экрана города (тёмная фаза).</p>
<p><a name="2.33"></a>
<font id="red"><b>!?FU(OnCloseTownScreen);</b></font><br>
Возникает после закрытия экрана города (тёмная фаза).</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер города, который был открыт изначально.</i></i></pre></p>
<p>Внутри экрана города переключаться между замками можно без генерации событий входа/выхода.</p>
<hr noshade>
<p><a name="2.34"></a>
<font id="red"><b>!?FU(OnSwitchTownScreen);</b></font><br>
Возникает при переключении замков в окне города.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер города</i></i></pre></p>
<hr noshade>
<p><a name="2.35"></a>
<font id="red"><b>!?FU(OnPreTownScreen);</b></font><br>
Возникает до отображения экрана города (тёмная фаза).</p>
<p><a name="2.36"></a>
<font id="red"><b>!?FU(OnPostTownScreen);</b></font><br>
Возникает когда закрывается экран города (тёмная фаза).</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер города</i></i></pre></p>
<p>Оба события происходят для определённого замка и независимо от того, открывается/закрывается или переключается экран города.<br>
Их можно использовать, например, для предварительного изменения названий/зданий/жилищ и отмены изменений впоследствии.</p>
<hr noshade>
<p><a name="2.37"></a>
<font id="red"><b>!?FU(OnPreHeroScreen);</b></font><br>
Возникает перед загрузкой экрана героя (тёмная фаза).</p>
<p><a name="2.38"></a>
<font id="red"><b>!?FU(OnPostHeroScreen);</b></font><br>
Возникает после закрытия экрана героя (тёмная фаза).</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер героя</i></i></pre></p>
<p>Оба события происходят для определённого героя и независимо от того, открывается/закрывается экран героя или идёт переключение между героями.<br>
Их можно использовать для предварительного изменения существ/названий/навыков героя  и отмены изменений впоследствии.</p>
<hr noshade>
<h3><a name="1.0"></a>Расширенные стандартные события в ERA</h3>
<p>Расширенные стандартные события также обладают собственными <a href="../Rec/SN_era.htm#X">SN:X</a> параметрами и дополнительными возможностями.</p>
<p><a name="1.1"></a>
<font id="red"><b>!?GM1</b></font><br>
Триггер на сохранение игры.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>имя сохранения</i></pre></p>
<p><u>Пример</u>:
<script type="erm">!?GM1;
!!SN:X?z1; получили имя сохраняемой игры.
!!VRz1:+^_%Gc^; добавили к нему цвет текущего игрока
!!SN:Xz1; установили новое имя сохранения</script>
Если красный игрок выбрал <code>newgame</code>, то игра будет сохранена в файл <i class="file">newgame_Красный.gm1</i>.</p>
<hr noshade>
<p><a name="1.2"></a>
<font id="red"><b>!?MM0</b></font><br>
Триггер для контроля над текстом в битве.</p>
<p><pre id="Q1"><b>Параметры:</b>
 1:  <i>номер текущего отряда или -1</i>
 2:  <i>номер вражеского отряда, на который наведён курсор или -1</i>
 3:  <i>минимальный урон</i>
 4:  <i>максимальный урон</i></pre></p>
<p><u>Пример</u>:<br>
Триггер удобен для замены стандартной подсказки в бою на расширенную с указанием, сколько единиц противника будет убито при ударе.
<script type="erm">!?MM;
!!VRy1:Cx1/x2/x3/x4; получили параметры события в y1..y4
!!FU&y2=-1:E; вышли, если это не подсказка об уроне
!!BMy2:H?y5 L?y6 N?y7; y5 - жизнь, y6 - потерянное здоровье, y7 - количество единиц противника
!!VRy8:Sy5-y6; y8 - здоровье последней единицы отряда
!!VRy9:Sy3:y5; y9 - минимальное количество, умрут
!!VRy10:Sy3%y5; y10 - урон по последней единице в худшем случае
!!VRy9&y10>=y8:+1; y9 - минимальное количество, умрут
!!VRy11:Sy4:y5; y11 - максимальное количество, умрут
!!VRy12:Sy4%y5; y12 - урон по последней единице в лучшем случае
!!VRy11&y12>=y8:+1; y11 - максимальное количество, умрут
!!VRy13:Sy5*y7-y6; y13 - общее количество здоровья отряда
!!VRy9&y9>y7:Sy7; y9 - минимальное количество, умрут
!!VRy11&y11>y7:Sy7; y11 - максимальное количество, умрут
!!IF:V2/0;
!!IF&y9=y11:V2/1; флаг 2 говорит о том, что минимальный и максимальный уроны совпадают
!!IF:V3/0;
!!IF&y9=y7:V3/1; флаг 3 говорит о том, что весь отряд по-любому умрёт
!!VRz2:S^%Y3-%Y4^; урон в формате "минимальный - максимальный"
!!VRz2&y3=y4:S^%Y3^; урон в формате "урон"
!!VRz3:S^Damage:^;
!!if&3:; если весь отряд умрёт
  !!VRz1:S^%Z3 %Z2. {~Yellow}FATALITY{~}^;
!!el:;
  !!VRz1:S^%Z3 %Z2. Kills: {~Yellow}%Y9-%Y11{~}^; урон с разбросом
  !!VRz1&2:S^%Z3 %Z2. Kills: {~Yellow}%Y9{~}^; урон без разброса
!!en:;
!!MM:Mz1; установить новую подсказку</script></p>
<hr noshade>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<font id="red"><b></b></font>
</div>
<script src="../erm.js"></script></body></html>
