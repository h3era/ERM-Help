<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>
Ресивер RD</title>
<LINK REL="stylesheet" MEDIA="screen" TYPE="text/css" HREF="../style.css">
<script src="script.js"></script></head>

<body scroll="no">
<DIV id="buttonMenu">
<SPAN CLASS="options">Опции&nbsp;RD:&nbsp;&nbsp;</SPAN>

 <SPAN CLASS="buttoninactive">A</SPAN>
 <SPAN CLASS="buttoninactive">B</SPAN>
	<A HREF="#C" title="Настроить диалог" CLASS="button">C</A>
 <SPAN CLASS="buttoninactive">D</SPAN>
 <SPAN CLASS="buttoninactive">E</SPAN>
	<A HREF="#F" title="Перевод реального номера слота в логический" CLASS="button">F</A>
 <SPAN CLASS="buttoninactive">G</SPAN>
 <SPAN CLASS="buttoninactive">H</SPAN>
	<A HREF="#I" title="Получить информацию по текущему диалогу" CLASS="button">I</A>
 <SPAN CLASS="buttoninactive">J</SPAN>
 <SPAN CLASS="buttoninactive">K</SPAN>
 <SPAN CLASS="buttoninactive">L</SPAN>
	<A HREF="#M" title="Доступ к ассоциативной памяти текущего диалога" CLASS="button">M</A>
 <SPAN CLASS="buttoninactive">N</SPAN>
	<A HREF="#O" title="Открыть новый диалог" CLASS="button">O</A>
 <SPAN CLASS="buttoninactive">P</SPAN>
 <SPAN CLASS="buttoninactive">Q</SPAN>
 <SPAN CLASS="buttoninactive">R</SPAN>
	<A HREF="#S" title="Сдвиг слотов" CLASS="button">S</A>
 <SPAN CLASS="buttoninactive">T</SPAN>
 <SPAN CLASS="buttoninactive">U</SPAN>
 <SPAN CLASS="buttoninactive">V</SPAN>
 <SPAN CLASS="buttoninactive">W</SPAN>
 <SPAN CLASS="buttoninactive">X</SPAN>
 <SPAN CLASS="buttoninactive">Y</SPAN>
 <SPAN CLASS="buttoninactive">Z</SPAN>

</DIV>

<DIV id="text">
<p align="center">
<font size="5">
<p align="center">Ресивер<b> RD</b><a href="../ERA/index.htm" title="Работает только с ERA.."><img src="../Img/era.gif" class="TE"></a>(диалог найма существ)</font>
<p align="left">
<b><font id="red"><br>
!!RD:XXXX;</font></b> 
- <b>позволяет настраивать игровой диалог найма существ самостоятельно.<br></b></p>
<p>Помимо команд работы с диалогом найма, в ERA были реализованы специальные события по обслуживанию этого диалога:
<ul>
<li><a name="open_23"></a><b><u onclick="HideIt(1)" class="h">OnOpenRecruitDlg (<b id="show1">показать</b>)</u></b><br><div id="1" class="b">
Всякий раз, когда создаётся диалог найма, запускается событие <i class="event">OnOpenRecruitDlg</i> со следующими параметрами:
<pre>        x1 - выбранный/активный слот монстра (0..3)
        х2 - флаги/опции, представляющие собой комбинацию битов, управляющих поведением диалога:
	= 1 – <a class="h" onclick="hidepic(10)" href="#"><small>CLOSE_ON_BUY</small></a></pre><div class="b" id="10">
<blockquote id="T0"><div id="step">Диалог закроется, когда будет нажата кнопка покупки.<br>
Обычно используется в городах, когда есть только один слот рекрута.<br>
Снимите этот флаг, чтобы принудительно закрывать диалог вручную.</div></blockquote></div>
<pre>	= 2 – <a class="h" onclick="hidepic(11)" href="#"><small>AUTO_UPDATE_ADVMAP</small></a></pre><div class="b" id="11">
<blockquote id="T0"><div id="step">Экран карты приключений необходимо обновлять после найма любого рекрута (даже когда отображается диалоговое окно).<br>
Этот флаг используется при найме рекрутов во внешнем жилище существ, что позволяет игроку видеть кол-во новых существ в окне статуса.</div></blockquote></div>
<pre>        x3 - включить диалог (1) или не показывать его (0).</pre>
</div></li>
<li><a name="close_24"></a><b><u onclick="HideIt(2)" class="h">OnCloseRecruitDlg (<b id="show2">показать</b>)</u></b><br><div id="2" class="b">
Когда вы закрываете диалог найма, запускается соответствующее событие <i class="event">OnCloseRecruitDlg</i> (без параметров)
</div></li>
<li><a name="click_25"></a><b><u onclick="HideIt(5)" class="h">OnRecruitDlgMouseClick (<b id="show5">показать</b>)</u></b><br><div id="5" class="b">
При клике мышью в диалоге найма запускается <i class="event">OnRecruitDlgMouseClick</i> (без параметров)
</div></li>
<li><a name="calc_28"></a><b><u onclick="HideIt(3)" class="h">OnRecruitDlgRecalc (<b id="show3">показать</b>)</u></b><br><div id="3" class="b">
При изменении положения ползунка внутри диалога или смене активного слота выполняется пересчёт кол-ва рекрутов и общей стоимости в событии <i class="event">OnRecruitDlgRecalc</i>. 
Все параметры могут быть изменены:
<pre>        x1 - стоимость существа в золоте
        x2 - идентификатор ресурса (0..5 или -1)
        х3 - кол-во ресурса</pre>
</div></li>
<li><a name="action_29"></a><b><u onclick="HideIt(4)" class="h">OnRecruitDlgAction (<b id="show4">показать</b>)</u></b><br><div id="4" class="b">
При найме нескольких разных существ запускается <i class="event">OnRecruitDlgAction</i>
<pre>        x1 - кол-во рекрутов (только чтение)</pre>
</div></li>
</ul></p>
<p>Наглядный пример создания диалога найма <a href="#ex" onclick="HideIt(8)">см. ниже</a></p>  
<hr noshade>
<p><a name="C"></a><b><font id="red">C#1/$2[/$3/$4/#5]</font></b><br>
Настроить диалог найма.
<pre>        #1 - слот диалога (0..3)
        $2 - <a href="../Form/Creature.htm" target="form">тип существа</a> для найма в указанном слоте (-1 = слот пуст)
        $3 - текущее кол-во существ для найма
        $4 - индекс источника/хранилища, где имеется доступное кол-во существ
        #5 - модификатор (0 = использовать оригинальное кол-во существ)</pre>
<b><u onclick="HideIt(12)" class="h">Комментарии (<b id="show12">показать</b>)</u></b><br><div id="12" class="b">
<ul>
<li>Если #5=0, то это оригинальное число нанимаемых монстров, которое запоминается сразу после события <a href="#open_23" class="event">OnOpenRecruitDlg</a> (можно только получить). Кол-во существ, как правило, напрямую связано с каким-либо источником, например, c жилищем в городе. Таким образом, устанавливая это значение на этапе настройки, вы меняете реальное кол-во существ.</li>
<li>Для существующих городов на карте можно использовать следующую формулу по источнику:
	<blockquote>[<b id="WT">Источник</b>] = [Идентификатор города (см. <a href="CA.htm#U">CA:U</a>)] &times; 14 + [уровень жилища существ в городе (0..6)] + [7 (только для улучшенных)].</blockquote>
	К примеру, источник 2го города на карте &rarr; 3-е улучш.жилище: 1 * 14 + 3 + 7 = 24.</li>
<li>Если диалог вызывается со специальными внешними источниками (определил игрок), они будут иметь следующие индексы: 9000, 9001, 9002, 9003. Например, модмейкер реализовал своё жилище в городе с некием хранилищем, где задано кол-во существ для найма. Скриптеры смогут видеть такой индекс источника как 9000.</li>
<li>Пользовательский источник (индекс &ge; 10000). Реализация по скрипту игрока. Для такого вида источника выделяется уникальный блок памяти. Требует установки начального кол-ва рекрутов в <a href="#open_23" class="event">OnOpenRecruitDlg</a>, с последующим получением окончательного (оставшегося) кол-ва в <a href="#close_24" class="event">OnCloseRecruitDlg</a>.</li>
<li>Один и тот же источник может быть назначен любому числу слотов диалога. Все эти слоты будут отображать одинаковое кол-во существ и обновляться одновременно. Это полезно для реализации альтернативных существ. Слоты могут иметь разные типы существ (и стоимость), но общее кол-во новобранцев распределяется между всеми слотами.</li>
<li>Индекс источника изменяется до применения нового кол-ва монстров. Так <b id="erm"><font class="re">!!RD</font>:C0/13/100/20000</b> изменит источник сначала до 20000 (пользовательский), а затем установит кол-во монстров как 100 архангелов, не меняя первоначальный прирост жилища/объекта/и т.д.</li>
<li>Если для слотов 0 и 3, к примеру, установить определённых существ, а для слотов 1 и 2 существ не определять (тип = -1), то произойдёт сдвиг слотов так, что игрок увидит только два первых слота с существами.<br>
Диалоги без настроенных слотов ($2&ne;-1) не будут показаны.</li>
</ul>
<u>Пример</u>:
<script type="erm">!!RD:C2/?y3; y3 = тип монстра в 3-ем реальном слоте диалога

Увеличить в 10 раз кол-во существ в 1-ом слоте диалога найма:
!!RD:C0/?t/d*10; тип не изменится, кол-во умножаем а 10
!!RD:C0/?t/?i^numMons^;
!!IF:M^Доступно %I(numMons) рекрутов для найма^;</script></div></p>

<hr noshade>
<p><a name="F"></a><b><font id="red">F#/$</font></b><br>
Перевести реальный номер слота в логический (используется с командой <a href="#C">C</a>)
<pre>        # - реальный (видимый) слот (0..3)
        $ - логический слот (0..3, -1 = пустой)</pre>
<b><u onclick="HideIt(13)" class="h">Комментарии (<b id="show13">показать</b>)</u></b><br><div id="13" class="b">
Команда используется вместе с обработкой мыши в диалоге найма. Номера видимых слотов последовательно увеличиваются и их надо преобразовавать в номера логических слотов.
<u>Пример</u>:<br>
Диалог с настроенными слотами: <b class="erm_b" id="dred">монстр&nbsp;А</b>&nbsp;<b class="erm_b" id="dred">слот&nbsp;пуст</b>&nbsp;<b class="erm_b" id="dred">слот&nbsp;пуст</b>&nbsp;<b class="erm_b" id="dred">монстр&nbsp;Б</b>, 
- отображается в игре так: <b class="erm_b" id="N3">монстр&nbsp;А</b>&nbsp;<b class="erm_b" id="N3">монстр&nbsp;Б</b>. Здесь "монстр Б" имеет реальный номер слота 1, а логический - 3.</div></p>

<hr noshade>
<p><a name="I"></a><b><font id="red">I?$1/?$2/?$3/?$4</font></b><br>
Получить информацию по текущему диалогу найма.
<pre>        $1 - уникальный номер диалога. Используется для различения вложенных диалогов.
        $2 - идентификатор города (см. <a href="CA.htm#U">CA:U</a>), для которого открывается диалог (-1 = нет/неизвестно).
        $3 - идентификатор городского жилища (0..6 - обычное, 7..13 - улучш.; -1 = нет/неизвестно)
	Здания Орд (+ X прирост) рассматриваются как жилища, на которые они влияют.
        $4 - номер выбранного логического слота.</pre>
<b><u onclick="HideIt(9)" class="h">Комментарий (<b id="show9">показать</b>)</u></b><br><div id="9" class="b">
Номера диалогов уникальны только среди открытых диалогов найма в текущий момент.<br>
После закрытия всей цепочки диалогов найма рекрутов номера диалогов возвращаются в резерв и могут быть назначены новым диалогам (эдакая многоразовость).</div></p>

<hr noshade>
<p><a name="M"></a><b><font id="red">M#/$</font></b><br>
Доступ к ассоциативной памяти текущего диалога.
<pre>        # - либо целое число, либо уникальная строка. То же, что и <a href="SN_era.htm#W">SN:W</a>
        $ - установить/получить значение переменной</pre></p>
<p>Команда обеспечивает полнофункциональный эквивалент <a href="SN_era.htm#W">SN:W</a> при работе с памятью, выделенной для каждого созданного диалога найма.<br>
Память освобождается после <a href="#close_24" class="event">OnCloseRecruitDlg</a> для каждого диалога.<br>
<u>Пример</u>:
<script type="erm">!!RD:M^acm.mapX^/v998 M^acm.mapY^/v999 M^acm.mapZ^/v1000;
!!RD:M^мифрил^/d*2;</script></p>

<hr noshade>
<p><a name="O"></a><b><font id="red">O#1/#2/#3/#4[/#5]</font></b><br>
Открыть новый диалог найма (предыдущие диалоги останутся в фоновом режиме).
<pre>        #1 - идентификатор города (см. <a href="CA.htm#U">CA:U</a>; -1 = пропустить). Город будет использоваться как источник слотов.
        #2 - идентификатор городского жилища (0..13; -1 = пропустить). Жилище будет использоваться как источник слотов.
        #3 - куда помещать рекрутов при найме (определяется сценарием Lua/ERM и обрабатыватся вручную):
	= 0 – в гарнизон города
	= 1 – в армию героя
	= 2 – своя реализация
        #4 - идентификатор цели (герой, город или спец. значение для сценария Lua/ERM)
        #5 - комбинация флагов <small id="WT">CLOSE_ON_BUY</small> и <small id="WT">AUTO_UPDATE_ADVMAP</small> (см. <a href="#open_23" onclick="HideIt(1)" class="event">OnOpenRecruitDlg</a>)
	Не устанавливайте этот параметр, если используете собственные/стандартные настройки.</pre>
</p>

<hr noshade>
<p><a name="S"></a><b><font id="red">S#</font></b><br>
Сдвиг слотов на # позиций.<br>
В диалоге найма можно сдвигать все слоты на указанное число позиций вправо (# &gt; 0) или влево (# &lt; 0).<br>
Если слот выходит за пределы логических значений (0..3), он исчезает.<br>
Сдвиг выполняется при сохранении всех настроек (тип, кол-во, источник)<br>
<b><u onclick="HideIt(15)" class="h">Примеры (<b id="show15">показать</b>)</u></b><br><div id="15" class="b">
<u>Пример 1</u>. Имеем 0..1 слоты с обычными и улучшенными существами (источник не важен):<br>
<b class="erm_b" id="N3">монстр&nbsp;А</b>&nbsp;<b class="erm_b" id="N3">монстр&nbsp;Б</b>&nbsp;<b class="erm_b" id="N3">слот&nbsp;пуст</b>&nbsp;<b class="erm_b" id="N3">слот&nbsp;пуст</b><br>
Необходимо подготовить два пользовательских слота с Ангелами/Архангелами в них.
<script type="erm">!!RD:S2;
!!RD:C0/12/2/12345 C1/13/2/54321;</script>
Получаем следующее:<br>
<b class="erm_b" id="N3">2&nbsp;ангела</b>&nbsp;<b class="erm_b" id="N3">2&nbsp;архангела</b>&nbsp;<b class="erm_b" id="N3">монстр&nbsp;А</b>&nbsp;<b class="erm_b" id="N3">монстр&nbsp;Б</b>.<br>
<br>
<u>Пример 2</u>. Удалить 1-й слот с улучшенными монстрами и оставить только неулучшенных.
<script type="erm">!!RD:C0/?t/?t/?y2; в y2 значение источника для 1го слота, t - временная быстрая переменная
!!VRy2:%14; вычисляем идентификатор жилища 0..13. Если улучшенное, то y2>=7 
!!RD&y2>=7:S-1; сместить на 1 слоты влево, если у 1го слота источник - улучшенное жилище в городе</script></div></p>

<hr noshade>

<p><a name="ex"></a>
Демонстрационный скрипт применения <a href="#">!!RD</a> от <code id="N1">Berserker</code>'а<b> (<u onclick="HideIt(8)" class="h" id="show8">показать</u>)</b><div id="8" class="b">
В Цитадели можно нанимать троллей вместо орков в соотношении 3:10 (1 тролль = 3.333 орка). К примеру, 8 орков можно нанять как 2 тролля + 1 орк или 1 тролль + 4 орка. Т.е. найм идёт по принципу - либо малое число одних, либо большое других. (<a target="form" href="../Form/rd_s1.htm">см. скриншот</a>)<br>
Все значения обновляются в реальном времени.
<script type="erm">** Демо-реализация мода на альтернативные существа **
!?FU(atm.UpdateSlots);
!!RD:C0/?y99/?y1/?y99/0; стандартное кол-во орков
!!RD:M^rate_x^/?y2; кол-во троллей для...
!!RD:M^rate_y^/?y3; ...присваивания кол-ву орков
!!RD:M^percentage_left^/?e1; доступное кол-во монстров в %
!!VRe9:S1:100; e9 - эпсилон (возможная ошибка округления)
!!VRe2:Sy1 *y2 :y3 *e1 +e9; оставшееся число троллей
!!VRy4:Se2; округляем оставшееся число троллей
!!RD:C2/?y99/y4; обновить кол-во троллей
!!VRe3:Sy1 *e1 +e9; оставшееся число орков
!!VRy5:Se3; округляем оставшееся число орков
!!RD:C0/?y99/y5; обновить кол-во орков

!?FU(OnOpenRecruitDlg);
!!RD:I?y1/?y2/?y3;
!!FU|y2=-1/y3=-1:E; выход, если нет жилища в городе
!!FU&y3<>2/y3<>9:E; выход, если нет жилища 3го уровня (простого или улучш.)
!!CA0/y2:T?y4; тип замка
!!FU&y4<>6:E; выход, если не Цитадель
!!VRx2:S0; отменить автозакрытие диалога при покупке
!!RD:M^is_unequal_alt^/1; пометить диалог как "наш"
!!VRe1:S1; кол-во доступных альтер-существ (1 = 100%)
!!RD:M^percentage_left^/e1; сохранить число доступных существ в %
; запомнить курс орки/тролли
!!RD:M^rate_x^/3; 3 тролля...
!!RD:M^rate_y^/10; ...взамен 10 орков
!!RD:C2/144/0/10000; настройка слота троллей
!!FU(atm.UpdateSlots):P;

!?FU(OnRecruitDlgAction);
!!RD:M^is_unequal_alt^/?y1; y1=1 если это atm-диалог
!!FU&y1<>1:E;
!!VRy2:Sx1; кол-во нанятых монстров
!!RD:I?y99/?y99/?y99/?y3; активный слот
!!RD:M^rate_x^/?y4; курс тролли/орки
!!RD:M^rate_y^/?y5;
!!RD:C0/?y99/?y6/?y99/0; y6 - стандартное кол-во орков
!!RD:M^percentage_left^/?e1; доступное кол-во монстров в %
!!if&y3=2:;
  !!VRe2:Sy2 *y5 :y4 :y6; нанятый процент
!!el:;
  !!VRe2:Sy2 :y6; нанятый процент
!!en:;
!!VRe1:-e2;
!!RD:M^percentage_left^/e1; обновить оставшийся процент
!!FU(atm.UpdateSlots):P;</script>
</div></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

</DIV>
<script src="../erm.js"></script></body></html>